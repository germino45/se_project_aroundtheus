!function(){"use strict";class e{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t}_showInputError(e){const t=this._form.querySelector(`.${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._form.querySelector(`.${e.id}-error`);e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_toggleInputState(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_checkValidity(e){return!e.validity.valid}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}toggleButtonState(){if(this._hasInvalidInput())return this._buttonEl.classList.add(this._inactiveButtonClass),void(this._buttonEl.disabled=!0);this._buttonEl.classList.remove(this._inactiveButtonClass),this._buttonEl.disabled=!1}_setEventListeners(){this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector)),this._buttonEl=this._form.querySelector(this._submitButtonSelector),this.toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._toggleInputState(e),this.toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}function t(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class r{constructor(e){t(this,"handleButtonclose",(()=>{this.close()})),t(this,"_handleEscapeClose",(e=>{"Escape"===e.key&&this.close()})),t(this,"_handleOverlayClick",(e=>{e.target.classList.contains("modal")&&this.close()})),this._popupElement=document.querySelector(e),this._closeButton=this._popupElement.querySelector(".modal__close-button")}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscapeClose)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscapeClose)}setEventListeners(){this._closeButton.addEventListener("click",this.handleButtonclose),this._popupElement.addEventListener("mousedown",this._handleOverlayClick)}}var s=class extends r{constructor(e,t){super(e),this._popupForm=this._popupElement.querySelector(".form"),this._inputs=this._popupForm.querySelectorAll(".form__input"),this._saveButton=this._popupForm.querySelector(".form__save-button"),this._handleFormSubmit=t}_getInputValues(){const e={};return this._inputs.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault();const t=this._getInputValues();this._handleFormSubmit(t),this.close()}))}close(){this._popupForm.reset(),super.close()}renderLoading(e,t){this._saveButton.textContent=e?"Saving...":t}};function i(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class n{constructor(e,t,r){i(this,"_handleLikeIcon",(()=>{this._likeButton.classList.toggle("card__like-button_activated")})),i(this,"_handleDeleteCard",(()=>{this._element.remove(),this._element=null})),this._name=e.name,this._link=e.link,this._handleImageClick=r,this._cardSelector=t}_setEventListeners(){this._likeButton.addEventListener("click",this._handleLikeIcon),this._deleteButton.addEventListener("click",this._handleDeleteCard),this._cardImageEl.addEventListener("click",(()=>this._handlePreviewPicture(this._name,this._link)))}_handlePreviewPicture(){this._handleImageClick(this._name,this._link)}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}getView(){return this._element=this._getTemplate(),this._cardImageEl=this._element.querySelector(".card__image"),this._likeButton=this._element.querySelector(".card__like-button"),this._deleteButton=this._element.querySelector("#card-delete-button"),this._cardImage=this._element.querySelector(".card__image"),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._cardText=this._element.querySelector(".card__text"),this._cardText.textContent=this._name,this._setEventListeners(),this._element}}const o={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__save-button",inactiveButtonClass:"form__save-button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error"},a=(document.getElementById("header-logo"),document.getElementById("profile-image")),l=document.querySelector("#profile-edit-button"),c=document.querySelector("#profile-title-input"),h=document.querySelector("#profile-description-input"),d=document.querySelector("#profile-form"),u=(document.querySelector("#profile-close-button"),document.querySelector(".profile__title")),_=document.querySelector(".profile__description"),p=document.querySelector("#card-add-button"),m=document.querySelector("#add-form"),v={cardSection:".cards__list",cardTemplate:"#card-template",cardPreviewPopup:"#image-modal",profilePopup:"#profile-modal",addCardPopup:"#add-modal"};let f,g;const b=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error ${e.status}`)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then(this._checkResponse)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{method:"GET",headers:this._headers}).then(this._checkResponse)}getApiInfo(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}editUserInfo(e,t){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}addNewCard(e,t){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}deleteUserCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}addLikes(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}deleteLikes(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}updateProfileAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"524dc900-b8ae-4b17-aa07-465dc385d766","Content-type":"application/json"}}),E=new class{constructor(e,t,r){this._userName=e,this._userJob=t,this._avatar=r}getUserInfo(){return{name:this._userName.textContent,job:this._userJob.textContent}}getAvatar(){return{avatar:this._avatar.src}}setUserInfo(e,t){this._userName.textContent=e,this._userJob.textContent=t}setAvatar(e){this._avatar.src=e.avatar,this._avatar.alt=e.name}}(u,_,a),y=new s(v.profilePopup,(function(e){return y.renderLoading(!0),b.editUserInfo(e.title,e.description).then((()=>{E.setUserInfo(e.title,e.description),y.close()})).catch((e=>{console.log(e)})).finally((()=>{y.renderLoading(!1,"Save")}))})),S=new s(v.addCardPopup,((e,t)=>{S.renderLoading(!0),b.addNewCard(e,t).then((e=>{const t=k(e);addCardPopup.close(),g.addItem(t.renderCard())})).catch((e=>{console.log(e)})).finally((()=>{S.renderLoading(!1,"Create")}))})),C=new class extends r{constructor(e){super(e),this._image=this._popupElement.querySelector(".modal__image-picture"),this._caption=this._popupElement.querySelector(".modal__image-caption")}open(e,t){this._image.src=t,this._image.alt=e,this._caption.textContent=e,super.open()}}(v.cardPreviewPopup,I);function L(e){const t=k(e);g.addItem(t)}function k(e){return new n(e,v.cardTemplate,I).getView()}function I(e,t){C.open(e,t)}y.setEventListeners(),S.setEventListeners(),C.setEventListeners(),l.addEventListener("click",(()=>{!function(){const e=E.getUserInfo();c.value=e.name,h.value=e.job,q.toggleButtonState(),y.open()}()})),p.addEventListener("click",(()=>{S.open(),w.toggleButtonState()})),b.getApiInfo().then((e=>{let[t,r]=e;f=t._id,E.setUserInfo(t),E.setAvatar(t),new class{constructor(e,t){let{items:r,renderer:s}=e;this._items=r,this._renderer=s,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:r,renderer:L},v.cardSection).renderItems()})).catch((e=>{console.log(e)}));const q=new e(o,d),w=new e(o,m);q.enableValidation(),w.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TCxRQUFRb0IsR0FDTmpNLEtBQUsrTCxXQUFXRyxRQUFRRCxFQUMxQixHSDJISSxDQUFFTixNQUFPSCxFQUFXSSxTQUFVZCxHQUM5Qi9ELEVBQW1CQyxhQUVUZ0YsYUFBYSxJQUUxQjNCLE9BQU9DLElBQ05DLFFBQVFDLElBQUlGLEVBQUksSUFpQ3BCLE1BQU1jLEVBQW9CLElBQUl4TCxFQUFjdUcsRUFBb0JPLEdBQzFENEUsRUFBbUIsSUFBSTFMLEVBQWN1RyxFQUFvQlcsR0FFL0RzRSxFQUFrQjdJLG1CQUNsQitJLEVBQWlCL0ksa0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL0NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL0NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9Db21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvQ29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvQ29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9Db21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL0NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9Db21wb25lbnRzL1NlY3Rpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XG4gIGNvbnN0cnVjdG9yKHNldHRpbmdzLCBmb3JtRWwpIHtcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzO1xuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcbiAgICB0aGlzLl9lcnJvckNsYXNzID0gc2V0dGluZ3MuZXJyb3JDbGFzcztcblxuICAgIHRoaXMuX2Zvcm0gPSBmb3JtRWw7XG4gIH1cblxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbCkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICAgIGlucHV0RWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yTWVzc2FnZUVsLnRleHRDb250ZW50ID0gaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZTtcbiAgICBlcnJvck1lc3NhZ2VFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWwpIHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcbiAgICBlcnJvck1lc3NhZ2VFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICAgIGVycm9yTWVzc2FnZUVsLnRleHRDb250ZW50ID0gXCJcIjtcbiAgfVxuXG4gIF90b2dnbGVJbnB1dFN0YXRlKGlucHV0RWwpIHtcbiAgICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsKTtcbiAgICB9XG4gIH1cblxuICBfY2hlY2tWYWxpZGl0eShpbnB1dEVsKSB7XG4gICAgcmV0dXJuICFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkO1xuICB9XG5cbiAgX2hhc0ludmFsaWRJbnB1dCgpIHtcbiAgICByZXR1cm4gdGhpcy5faW5wdXRMaXN0LnNvbWUoKGlucHV0RWwpID0+IHtcbiAgICAgIHJldHVybiAhaW5wdXRFbC52YWxpZGl0eS52YWxpZDtcbiAgICB9KTtcbiAgfVxuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKCkge1xuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xuICAgICAgdGhpcy5fYnV0dG9uRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX2J1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICB0aGlzLl9idXR0b25FbC5kaXNhYmxlZCA9IGZhbHNlO1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2lucHV0TGlzdCA9IEFycmF5LmZyb20oXG4gICAgICB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5faW5wdXRTZWxlY3RvcilcbiAgICApO1xuICAgIHRoaXMuX2J1dHRvbkVsID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcblxuICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoKTtcblxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUlucHV0U3RhdGUoaW5wdXRFbCk7XG4gICAgICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZW5hYmxlVmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5fY2xvc2VCdXR0b24gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLm1vZGFsX19jbG9zZS1idXR0b25cIlxuICAgICk7XG4gIH1cblxuICBvcGVuKCkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY2FwZUNsb3NlKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY2FwZUNsb3NlKTtcbiAgfVxuXG4gIGhhbmRsZUJ1dHRvbmNsb3NlID0gKCkgPT4ge1xuICAgIHRoaXMuY2xvc2UoKTtcbiAgfTtcblxuICBfaGFuZGxlRXNjYXBlQ2xvc2UgPSAoZSkgPT4ge1xuICAgIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfTtcblxuICBfaGFuZGxlT3ZlcmxheUNsaWNrID0gKGUpID0+IHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuaGFuZGxlQnV0dG9uY2xvc2UpO1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX2hhbmRsZU92ZXJsYXlDbGljayk7XG4gIH1cbn1cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5jbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuXG4gICAgdGhpcy5faW1hZ2UgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2UtcGljdHVyZVwiKTtcbiAgICB0aGlzLl9jYXB0aW9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlLWNhcHRpb25cIik7XG4gIH1cbiAgb3BlbihuYW1lLCBsaW5rKSB7XG4gICAgdGhpcy5faW1hZ2Uuc3JjID0gbGluaztcbiAgICB0aGlzLl9pbWFnZS5hbHQgPSBuYW1lO1xuICAgIHRoaXMuX2NhcHRpb24udGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQb3B1cFdpdGhJbWFnZTtcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5jbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG5cbiAgICB0aGlzLl9wb3B1cEZvcm0gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xuICAgIHRoaXMuX2lucHV0cyA9IHRoaXMuX3BvcHVwRm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLmZvcm1fX2lucHV0XCIpO1xuICAgIHRoaXMuX3NhdmVCdXR0b24gPSB0aGlzLl9wb3B1cEZvcm0ucXVlcnlTZWxlY3RvcihcIi5mb3JtX19zYXZlLWJ1dHRvblwiKTtcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgfVxuXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICBjb25zdCBpbnB1dE9iaiA9IHt9O1xuXG4gICAgdGhpcy5faW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBpbnB1dE9ialtpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgIH0pO1xuICAgIHJldHVybiBpbnB1dE9iajtcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fcG9wdXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IGlucHV0VmFsdWVzID0gdGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKTtcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQoaW5wdXRWYWx1ZXMpO1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5fcG9wdXBGb3JtLnJlc2V0KCk7XG4gICAgc3VwZXIuY2xvc2UoKTtcbiAgfVxuXG4gIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nLCBzYXZlQnV0dG9uVGV4dCkge1xuICAgIGlmIChpc0xvYWRpbmcpIHtcbiAgICAgIHRoaXMuX3NhdmVCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zYXZlQnV0dG9uLnRleHRDb250ZW50ID0gc2F2ZUJ1dHRvblRleHQ7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aEZvcm07XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3IoZGF0YSwgY2FyZFNlbGVjdG9yLCBoYW5kbGVJbWFnZUNsaWNrKSB7XG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xuICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sgPSBoYW5kbGVJbWFnZUNsaWNrO1xuXG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2xpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZUxpa2VJY29uKTtcblxuICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCk7XG5cbiAgICB0aGlzLl9jYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cbiAgICAgIHRoaXMuX2hhbmRsZVByZXZpZXdQaWN0dXJlKHRoaXMuX25hbWUsIHRoaXMuX2xpbmspXG4gICAgKTtcbiAgfVxuXG4gIF9oYW5kbGVMaWtlSWNvbiA9ICgpID0+IHtcbiAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmF0ZWRcIik7XG4gIH07XG5cbiAgX2hhbmRsZURlbGV0ZUNhcmQgPSAoKSA9PiB7XG4gICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcblxuICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xuICB9O1xuXG4gIF9oYW5kbGVQcmV2aWV3UGljdHVyZSgpIHtcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrKHRoaXMuX25hbWUsIHRoaXMuX2xpbmspO1xuICB9XG5cbiAgX2dldFRlbXBsYXRlKCkge1xuICAgIHJldHVybiBkb2N1bWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKVxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xuICB9XG5cbiAgZ2V0VmlldygpIHtcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgICB0aGlzLl9saWtlQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLWRlbGV0ZS1idXR0b25cIik7XG4gICAgdGhpcy5fY2FyZEltYWdlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuXG4gICAgdGhpcy5fY2FyZEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XG4gICAgdGhpcy5fY2FyZEltYWdlLmFsdCA9IHRoaXMuX25hbWU7XG5cbiAgICB0aGlzLl9jYXJkVGV4dCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190ZXh0XCIpO1xuICAgIHRoaXMuX2NhcmRUZXh0LnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcblxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG5cbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgfVxufVxuIiwiY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICB7XG4gICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vbGl2ZS5zdGF0aWNmbGlja3IuY29tLzY1NTM1LzUwOTcwMzg2NzIyXzU1MGQxOWYxMWJfYi5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGFrZSBMb3Vpc2VcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vd3d3LndvcmxkYXRsYXMuY29tL3IvdzEyMDAtcTgwL3VwbG9hZC9iNC8yYy85NS9zaHV0dGVyc3RvY2stNTY5NzQxMDExLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly93d3cucm9hZHRyaXByeWFuLmNvbS9nby9yZXNvdXJjZXMvY29udGVudC91dGFoL25vcnRoZXJuLXV0YWgvYmFsZC1tb3V0YWluLXVpbnRhcy91c2VyLXN1Ym1pdHRlZC9yeWFuY29ybmlhLTE2MzE2NDE3NzgyMTcuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxhdGVtYXJcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vbWVkaWEuaXN0b2NrcGhvdG8uY29tL2lkLzE1NTM1OTExMC9waG90by9taWxreS13YXktaW4tdGhlLWFscHMuanBnP3M9NjEyeDYxMiZ3PTAmaz0yMCZjPXE5cHY0VnhIR1psbTBBSlJvUU1JVWp0blBoMlJMWG1tX01XeHlhMW5xNFE9XCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIlZhbm9pc2UgTmF0aW9uYWwgUGFya1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9waG90b3MudGhldHJlay5jby93cC1jb250ZW50L3VwbG9hZHMvMjAyMi8wNy8yODAzMDkzMC9kc2MwOTEwNS0wMTM3MjUzODgyNDQxNDg0OTg1NTguanBlZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJMYWdvIGRpIEJyYWllc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9leHBlcnR2YWdhYm9uZC5jb20vd3AtY29udGVudC91cGxvYWRzL2xhZ28tZGktYnJhaWVzLWl0YWx5LWd1aWRlLmpwZ1wiLFxuICB9LFxuXTtcblxuY29uc3QgdmFsaWRhdGlvblNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLmZvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIuZm9ybV9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLmZvcm1fX3NhdmUtYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwiZm9ybV9fc2F2ZS1idXR0b25fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcImZvcm1fX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJmb3JtX19pbnB1dC1lcnJvclwiLFxufTtcblxuY29uc3QgaGVhZGVySW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImhlYWRlci1sb2dvXCIpO1xuXG5jb25zdCBwcm9maWxlSW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInByb2ZpbGUtaW1hZ2VcIik7XG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBwcm9maWxlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWVkaXQtYnV0dG9uXCIpO1xuXG5jb25zdCB0aXRsZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLXRpdGxlLWlucHV0XCIpO1xuXG5jb25zdCBkZXNjcmlwdGlvbklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCIpO1xuXG5jb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1mb3JtXCIpO1xuXG5jb25zdCBwcm9maWxlQ2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtY2xvc2UtYnV0dG9uXCIpO1xuXG5jb25zdCBwcm9maWxlVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX3RpdGxlXCIpO1xuXG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBBZGQgQ2FyZCBNb2RhbCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5jb25zdCBjYXJkQWRkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLWFkZC1idXR0b25cIik7XG5cbmNvbnN0IGFkZENhcmRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtZm9ybVwiKTtcblxuY29uc3QgY29udGFpbmVyU2VsZWN0b3JzID0ge1xuICBjYXJkU2VjdGlvbjogXCIuY2FyZHNfX2xpc3RcIixcbiAgY2FyZFRlbXBsYXRlOiBcIiNjYXJkLXRlbXBsYXRlXCIsXG4gIGNhcmRQcmV2aWV3UG9wdXA6IFwiI2ltYWdlLW1vZGFsXCIsXG4gIHByb2ZpbGVQb3B1cDogXCIjcHJvZmlsZS1tb2RhbFwiLFxuICBhZGRDYXJkUG9wdXA6IFwiI2FkZC1tb2RhbFwiLFxufTtcblxuZXhwb3J0IHtcbiAgaW5pdGlhbENhcmRzLFxuICB2YWxpZGF0aW9uU2V0dGluZ3MsXG4gIGNvbnRhaW5lclNlbGVjdG9ycyxcbiAgaGVhZGVySW1hZ2UsXG4gIHByb2ZpbGVJbWFnZSxcbiAgcHJvZmlsZUVkaXRCdXR0b24sXG4gIHRpdGxlSW5wdXQsXG4gIGRlc2NyaXB0aW9uSW5wdXQsXG4gIHByb2ZpbGVGb3JtLFxuICBwcm9maWxlQ2xvc2VCdXR0b24sXG4gIHByb2ZpbGVUaXRsZSxcbiAgcHJvZmlsZURlc2NyaXB0aW9uLFxuICBjYXJkQWRkQnV0dG9uLFxuICBhZGRDYXJkRm9ybSxcbn07XG4iLCIvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEltcG9ydHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5cbmltcG9ydCBwcm9maWxlSW1hZ2VTcmMgZnJvbSBcIi4uL2ltYWdlcy9qYWNxdWVzLWNvdXN0ZWF1LmpwZ1wiO1xuXG5pbXBvcnQgaGVhZGVySW1hZ2VTcmMgZnJvbSBcIi4uL2ltYWdlcy9sb2dvLnN2Z1wiO1xuXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vQ29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XG5cbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9Db21wb25lbnRzL1NlY3Rpb24uanNcIjtcblxuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuLi9Db21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XG5cbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9Db21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcblxuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9Db21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5cbmltcG9ydCBDYXJkIGZyb20gXCIuLi9Db21wb25lbnRzL0NhcmQuanNcIjtcblxuaW1wb3J0IHtcbiAgaW5pdGlhbENhcmRzLFxuICB2YWxpZGF0aW9uU2V0dGluZ3MsXG4gIGNvbnRhaW5lclNlbGVjdG9ycyxcbiAgaGVhZGVySW1hZ2UsXG4gIHByb2ZpbGVJbWFnZSxcbiAgcHJvZmlsZUVkaXRCdXR0b24sXG4gIHRpdGxlSW5wdXQsXG4gIGRlc2NyaXB0aW9uSW5wdXQsXG4gIHByb2ZpbGVGb3JtLFxuICBwcm9maWxlVGl0bGUsXG4gIHByb2ZpbGVEZXNjcmlwdGlvbixcbiAgY2FyZEFkZEJ1dHRvbixcbiAgYWRkQ2FyZEZvcm0sXG59IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcblxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vQ29tcG9uZW50cy9BcGkuanNcIjtcblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbi8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5sZXQgdXNlcklkO1xubGV0IGNhcmRTZWN0aW9uO1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTEyXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjUyNGRjOTAwLWI4YWUtNGIxNy1hYTA3LTQ2NWRjMzg1ZDc2NlwiLFxuICAgIFwiQ29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHByb2ZpbGVUaXRsZSwgcHJvZmlsZURlc2NyaXB0aW9uLCBwcm9maWxlSW1hZ2UpO1xuXG5jb25zdCBlZGl0Rm9ybVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIGNvbnRhaW5lclNlbGVjdG9ycy5wcm9maWxlUG9wdXAsXG4gIHN1Ym1pdEVkaXRQcm9maWxlXG4pO1xuXG5jb25zdCBhZGRGb3JtUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybShcbiAgY29udGFpbmVyU2VsZWN0b3JzLmFkZENhcmRQb3B1cCxcbiAgKG5hbWUsIGxpbmspID0+IHtcbiAgICBhZGRGb3JtUG9wdXAucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgICBhcGlcbiAgICAgIC5hZGROZXdDYXJkKG5hbWUsIGxpbmspXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICBjb25zdCBjYXJkID0gY3JlYXRlQ2FyZChkYXRhKTtcbiAgICAgICAgYWRkQ2FyZFBvcHVwLmNsb3NlKCk7XG4gICAgICAgIGNhcmRTZWN0aW9uLmFkZEl0ZW0oY2FyZC5yZW5kZXJDYXJkKCkpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICB9KVxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBhZGRGb3JtUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSwgXCJDcmVhdGVcIik7XG4gICAgICB9KTtcbiAgfVxuKTtcblxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcbiAgY29udGFpbmVyU2VsZWN0b3JzLmNhcmRQcmV2aWV3UG9wdXAsXG4gIGhhbmRsZUltYWdlQ2xpY2tcbik7XG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG4vKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFdmVudCBMaXN0ZW5lcnMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZWRpdEZvcm1Qb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuYWRkRm9ybVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5pbWFnZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5FZGl0Rm9ybSgpO1xufSk7XG5cbmNhcmRBZGRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3BlbkFkZEZvcm0oKTtcbn0pO1xuXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIG9wZW5FZGl0Rm9ybSgpIHtcbiAgY29uc3QgcHJvZmlsZUluZm8gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuICB0aXRsZUlucHV0LnZhbHVlID0gcHJvZmlsZUluZm8ubmFtZTtcbiAgZGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHByb2ZpbGVJbmZvLmpvYjtcbiAgZWRpdEZvcm1WYWxpZGF0b3IudG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgZWRpdEZvcm1Qb3B1cC5vcGVuKCk7XG59XG5cbmZ1bmN0aW9uIHN1Ym1pdEVkaXRQcm9maWxlKGlucHV0VmFsdWVzKSB7XG4gIGVkaXRGb3JtUG9wdXAucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgcmV0dXJuIGFwaVxuICAgIC5lZGl0VXNlckluZm8oaW5wdXRWYWx1ZXMudGl0bGUsIGlucHV0VmFsdWVzLmRlc2NyaXB0aW9uKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKGlucHV0VmFsdWVzLnRpdGxlLCBpbnB1dFZhbHVlcy5kZXNjcmlwdGlvbik7XG4gICAgICBlZGl0Rm9ybVBvcHVwLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIGVkaXRGb3JtUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSwgXCJTYXZlXCIpO1xuICAgIH0pO1xufVxuXG5hcGlcbiAgLmdldEFwaUluZm8oKVxuICAudGhlbigoW3VzZXJEYXRhLCB1c2VyQ2FyZHNdKSA9PiB7XG4gICAgdXNlcklkID0gdXNlckRhdGEuX2lkO1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXJEYXRhKTtcbiAgICB1c2VySW5mby5zZXRBdmF0YXIodXNlckRhdGEpO1xuICAgIGNvbnN0IGNhcmRTZWN0aW9uID0gbmV3IFNlY3Rpb24oXG4gICAgICB7IGl0ZW1zOiB1c2VyQ2FyZHMsIHJlbmRlcmVyOiByZW5kZXJDYXJkIH0sXG4gICAgICBjb250YWluZXJTZWxlY3RvcnMuY2FyZFNlY3Rpb25cbiAgICApO1xuICAgIGNhcmRTZWN0aW9uLnJlbmRlckl0ZW1zKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTtcbiAgfSk7XG5cbmZ1bmN0aW9uIG9wZW5BZGRGb3JtKCkge1xuICBhZGRGb3JtUG9wdXAub3BlbigpO1xuICBhZGRGb3JtVmFsaWRhdG9yLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XG59XG5cbmZ1bmN0aW9uIHN1Ym1pdEFkZENhcmQoZGF0YSkge1xuICByZW5kZXJDYXJkKHsgbmFtZTogZGF0YS50aXRsZSwgbGluazogZGF0YS5saW5rIH0pO1xufVxuXG5mdW5jdGlvbiByZW5kZXJDYXJkKGRhdGEpIHtcbiAgY29uc3QgY2FyZCA9IGNyZWF0ZUNhcmQoZGF0YSk7XG4gIGNhcmRTZWN0aW9uLmFkZEl0ZW0oY2FyZCk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNhcmQoaXRlbSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IG5ldyBDYXJkKFxuICAgIGl0ZW0sXG4gICAgY29udGFpbmVyU2VsZWN0b3JzLmNhcmRUZW1wbGF0ZSxcbiAgICBoYW5kbGVJbWFnZUNsaWNrXG4gICkuZ2V0VmlldygpO1xuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUltYWdlQ2xpY2sobmFtZSwgbGluaykge1xuICBpbWFnZVBvcHVwLm9wZW4obmFtZSwgbGluayk7XG59XG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9ybSBWYWxpZGF0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG5cbmNvbnN0IGVkaXRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IodmFsaWRhdGlvblNldHRpbmdzLCBwcm9maWxlRm9ybSk7XG5jb25zdCBhZGRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IodmFsaWRhdGlvblNldHRpbmdzLCBhZGRDYXJkRm9ybSk7XG5cbmVkaXRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcbmFkZEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzIC0gaGVhZGVycztcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yICR7cmVzLnN0YXR1c31gKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBnZXRBcGlJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRVc2VySW5mbygpLCB0aGlzLmdldEluaXRpYWxDYXJkcygpXSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8obmFtZSwgYWJvdXQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGFib3V0LFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGFkZE5ld0NhcmQobmFtZSwgbGluaykge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBsaW5rLFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGRlbGV0ZVVzZXJDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBhZGRMaWtlcyhjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZGVsZXRlTGlrZXMoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIHVwZGF0ZVByb2ZpbGVBdmF0YXIoYXZhdGFyKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYXZhdGFyIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcbiAgY29uc3RydWN0b3IodXNlck5hbWUsIHVzZXJKb2IsIGF2YXRhcikge1xuICAgIHRoaXMuX3VzZXJOYW1lID0gdXNlck5hbWU7XG4gICAgdGhpcy5fdXNlckpvYiA9IHVzZXJKb2I7XG4gICAgdGhpcy5fYXZhdGFyID0gYXZhdGFyO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHsgbmFtZTogdGhpcy5fdXNlck5hbWUudGV4dENvbnRlbnQsIGpvYjogdGhpcy5fdXNlckpvYi50ZXh0Q29udGVudCB9O1xuICB9XG5cbiAgZ2V0QXZhdGFyKCkge1xuICAgIHJldHVybiB7IGF2YXRhcjogdGhpcy5fYXZhdGFyLnNyYyB9O1xuICB9XG5cbiAgc2V0VXNlckluZm8obmFtZSwgZGVzY3JpcHRpb24pIHtcbiAgICB0aGlzLl91c2VyTmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgdGhpcy5fdXNlckpvYi50ZXh0Q29udGVudCA9IGRlc2NyaXB0aW9uO1xuICB9XG5cbiAgc2V0QXZhdGFyKHZhbHVlKSB7XG4gICAgdGhpcy5fYXZhdGFyLnNyYyA9IHZhbHVlLmF2YXRhcjtcbiAgICB0aGlzLl9hdmF0YXIuYWx0ID0gdmFsdWUubmFtZTtcbiAgfVxufVxuIiwiY2xhc3MgU2VjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgdGhpcy5faXRlbXMgPSBpdGVtcztcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xuICB9XG5cbiAgcmVuZGVySXRlbXMoKSB7XG4gICAgdGhpcy5faXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgdGhpcy5fcmVuZGVyZXIoaXRlbSk7XG4gICAgfSk7XG4gIH1cblxuICBhZGRJdGVtKGVsZW1lbnQpIHtcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTZWN0aW9uO1xuIl0sIm5hbWVzIjpbIkZvcm1WYWxpZGF0b3IiLCJjb25zdHJ1Y3RvciIsInNldHRpbmdzIiwiZm9ybUVsIiwidGhpcyIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2lucHV0RXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9mb3JtIiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbCIsImVycm9yTWVzc2FnZUVsIiwicXVlcnlTZWxlY3RvciIsImlkIiwiY2xhc3NMaXN0IiwiYWRkIiwidGV4dENvbnRlbnQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9oaWRlSW5wdXRFcnJvciIsInJlbW92ZSIsIl90b2dnbGVJbnB1dFN0YXRlIiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9jaGVja1ZhbGlkaXR5IiwiX2hhc0ludmFsaWRJbnB1dCIsIl9pbnB1dExpc3QiLCJzb21lIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJfYnV0dG9uRWwiLCJkaXNhYmxlZCIsIl9zZXRFdmVudExpc3RlbmVycyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiYWRkRXZlbnRMaXN0ZW5lciIsImVuYWJsZVZhbGlkYXRpb24iLCJlIiwicHJldmVudERlZmF1bHQiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfZGVmaW5lUHJvcGVydHkiLCJjbG9zZSIsImtleSIsInRhcmdldCIsImNvbnRhaW5zIiwiX3BvcHVwRWxlbWVudCIsImRvY3VtZW50IiwiX2Nsb3NlQnV0dG9uIiwib3BlbiIsIl9oYW5kbGVFc2NhcGVDbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsImhhbmRsZUJ1dHRvbmNsb3NlIiwiX2hhbmRsZU92ZXJsYXlDbGljayIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9wb3B1cEZvcm0iLCJfaW5wdXRzIiwiX3NhdmVCdXR0b24iLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9nZXRJbnB1dFZhbHVlcyIsImlucHV0T2JqIiwiaW5wdXQiLCJuYW1lIiwidmFsdWUiLCJpbnB1dFZhbHVlcyIsInJlc2V0IiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsInNhdmVCdXR0b25UZXh0IiwiQ2FyZCIsImRhdGEiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVJbWFnZUNsaWNrIiwiX2xpa2VCdXR0b24iLCJ0b2dnbGUiLCJfZWxlbWVudCIsIl9uYW1lIiwiX2xpbmsiLCJsaW5rIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUxpa2VJY29uIiwiX2RlbGV0ZUJ1dHRvbiIsIl9oYW5kbGVEZWxldGVDYXJkIiwiX2NhcmRJbWFnZUVsIiwiX2hhbmRsZVByZXZpZXdQaWN0dXJlIiwiX2dldFRlbXBsYXRlIiwiY29udGVudCIsImNsb25lTm9kZSIsImdldFZpZXciLCJfY2FyZEltYWdlIiwic3JjIiwiYWx0IiwiX2NhcmRUZXh0IiwidmFsaWRhdGlvblNldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwicHJvZmlsZUltYWdlIiwiZ2V0RWxlbWVudEJ5SWQiLCJwcm9maWxlRWRpdEJ1dHRvbiIsInRpdGxlSW5wdXQiLCJkZXNjcmlwdGlvbklucHV0IiwicHJvZmlsZUZvcm0iLCJwcm9maWxlVGl0bGUiLCJwcm9maWxlRGVzY3JpcHRpb24iLCJjYXJkQWRkQnV0dG9uIiwiYWRkQ2FyZEZvcm0iLCJjb250YWluZXJTZWxlY3RvcnMiLCJjYXJkU2VjdGlvbiIsImNhcmRUZW1wbGF0ZSIsImNhcmRQcmV2aWV3UG9wdXAiLCJwcm9maWxlUG9wdXAiLCJhZGRDYXJkUG9wdXAiLCJ1c2VySWQiLCJhcGkiLCJfcmVmIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0VXNlckluZm8iLCJmZXRjaCIsIm1ldGhvZCIsInRoZW4iLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRBcGlJbmZvIiwiYWxsIiwiZWRpdFVzZXJJbmZvIiwiYWJvdXQiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZE5ld0NhcmQiLCJkZWxldGVVc2VyQ2FyZCIsImNhcmRJZCIsImFkZExpa2VzIiwiZGVsZXRlTGlrZXMiLCJ1cGRhdGVQcm9maWxlQXZhdGFyIiwiYXZhdGFyIiwiYXV0aG9yaXphdGlvbiIsInVzZXJJbmZvIiwidXNlck5hbWUiLCJ1c2VySm9iIiwiX3VzZXJOYW1lIiwiX3VzZXJKb2IiLCJfYXZhdGFyIiwiam9iIiwiZ2V0QXZhdGFyIiwic2V0VXNlckluZm8iLCJkZXNjcmlwdGlvbiIsInNldEF2YXRhciIsImVkaXRGb3JtUG9wdXAiLCJQb3B1cFdpdGhGb3JtIiwidGl0bGUiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJmaW5hbGx5IiwiYWRkRm9ybVBvcHVwIiwiY2FyZCIsImNyZWF0ZUNhcmQiLCJhZGRJdGVtIiwicmVuZGVyQ2FyZCIsImltYWdlUG9wdXAiLCJfaW1hZ2UiLCJfY2FwdGlvbiIsIml0ZW0iLCJwcm9maWxlSW5mbyIsImVkaXRGb3JtVmFsaWRhdG9yIiwib3BlbkVkaXRGb3JtIiwiYWRkRm9ybVZhbGlkYXRvciIsInVzZXJEYXRhIiwidXNlckNhcmRzIiwiX2lkIiwiY29udGFpbmVyU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsInJlbmRlckl0ZW1zIiwiZWxlbWVudCIsInByZXBlbmQiXSwic291cmNlUm9vdCI6IiJ9